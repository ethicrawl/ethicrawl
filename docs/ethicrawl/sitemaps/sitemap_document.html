<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>ethicrawl.sitemaps.sitemap_document API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ethicrawl.sitemaps.sitemap_document</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ethicrawl.sitemaps.sitemap_document.SitemapDocument"><code class="flex name class">
<span>class <span class="ident">SitemapDocument</span></span>
<span>(</span><span>context: <a title="ethicrawl.context.context.Context" href="../context/context.html#ethicrawl.context.context.Context">Context</a>,<br>document: str | None = None)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SitemapDocument:
    &#34;&#34;&#34;Parser and representation of XML sitemap documents.

    This class handles the parsing, validation, and extraction of entries from
    XML sitemap documents, supporting both sitemap index files and urlset files.
    It implements security best practices for XML parsing to prevent common
    vulnerabilities like XXE attacks.

    SitemapDocument distinguishes between sitemap indexes (which contain references
    to other sitemaps) and urlsets (which contain actual page URLs), extracting
    the appropriate entries in each case.

    Attributes:
        SITEMAP_NS: The official sitemap namespace URI
        entries: ResourceList containing the parsed sitemap entries
        type: The type of sitemap (sitemapindex, urlset, or unsupported)

    Example:
        &gt;&gt;&gt; from ethicrawl.context import Context
        &gt;&gt;&gt; from ethicrawl.core import Resource
        &gt;&gt;&gt; from ethicrawl.sitemaps import SitemapDocument
        &gt;&gt;&gt; context = Context(Resource(&#34;https://example.com&#34;))
        &gt;&gt;&gt; sitemap_xml = &#39;&#39;&#39;&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
        ... &lt;urlset xmlns=&#34;http://www.sitemaps.org/schemas/sitemap/0.9&#34;&gt;
        ...   &lt;url&gt;
        ...     &lt;loc&gt;https://example.com/page1&lt;/loc&gt;
        ...     &lt;lastmod&gt;2023-06-15T14:30:00Z&lt;/lastmod&gt;
        ...   &lt;/url&gt;
        ... &lt;/urlset&gt;&#39;&#39;&#39;
        &gt;&gt;&gt; sitemap = SitemapDocument(context, sitemap_xml)
        &gt;&gt;&gt; sitemap.type
        &#39;urlset&#39;
        &gt;&gt;&gt; len(sitemap.entries)
        1
    &#34;&#34;&#34;

    SITEMAP_NS = &#34;http://www.sitemaps.org/schemas/sitemap/0.9&#34;

    def __init__(self, context: Context, document: str | None = None) -&gt; None:
        &#34;&#34;&#34;Initialize a sitemap document parser with security protections.

        Sets up the XML parser with security features to prevent common
        XML vulnerabilities and optionally parses a provided document.

        Args:
            context: Context for logging and resource resolution
            document: Optional XML sitemap content to parse immediately

        Raises:
            SitemapError: If the provided document cannot be parsed
        &#34;&#34;&#34;
        self._context = context
        self._logger = self._context.logger(&#34;sitemap.document&#34;)
        # Add debug logging
        self._logger.debug(&#34;Creating new SitemapDocument instance&#34;)
        self._entries: ResourceList = ResourceList()
        self._parser = etree.XMLParser(
            resolve_entities=False,  # Prevent XXE attacks
            no_network=True,  # Prevent external resource loading
            dtd_validation=False,  # Don&#39;t validate DTDs
            load_dtd=False,  # Don&#39;t load DTDs at all
            huge_tree=False,  # Prevent XML bomb attacks
        )
        if document is not None:
            self._root = self._validate(document)

    def _escape_unescaped_ampersands(self, xml_document: str) -&gt; str:
        &#34;&#34;&#34;Escape unescaped ampersands in XML content.

        Args:
            xml_document: Raw XML string that may contain unescaped ampersands

        Returns:
            XML string with properly escaped ampersands
        &#34;&#34;&#34;
        pattern = r&#34;&amp;(?!(?:[a-zA-Z]+|#[0-9]+|#x[0-9a-fA-F]+);)&#34;
        return sub(pattern, &#34;&amp;amp;&#34;, xml_document)

    def _validate(self, document: str) -&gt; etree._Element:
        &#34;&#34;&#34;Validate and parse a sitemap XML document.

        This method:
        1. Escapes unescaped ampersands in the document
        2. Parses the XML using the secure parser
        3. Validates that it uses the correct sitemap namespace

        Args:
            document: XML document string to parse

        Returns:
            The parsed XML element tree root

        Raises:
            SitemapError: If the document has invalid XML or incorrect namespace
        &#34;&#34;&#34;
        document = self._escape_unescaped_ampersands(
            document
        )  # TODO: might want to move this to the HttpClient
        try:
            _element = etree.fromstring(document.encode(&#34;utf-8&#34;), parser=self._parser)
            if _element.nsmap[None] != SitemapDocument.SITEMAP_NS:
                self._logger.error(
                    &#34;Required default namespace not found: %s&#34;,
                    SitemapDocument.SITEMAP_NS,
                )
                raise SitemapError(
                    f&#34;Required default namespace not found: {SitemapDocument.SITEMAP_NS}&#34;
                )
            return _element
        except Exception as e:
            self._logger.error(&#34;Invalid XML syntax: %s&#34;, e)
            raise SitemapError(f&#34;Invalid XML syntax: {str(e)}&#34;) from e

    @property
    def entries(self) -&gt; ResourceList:
        &#34;&#34;&#34;Get the list of entries extracted from the sitemap.

        Returns:
            ResourceList containing SitemapEntry objects (either IndexEntry
            or UrlsetEntry depending on the sitemap type)
        &#34;&#34;&#34;
        return self._entries

    @property
    def type(self) -&gt; str:
        &#34;&#34;&#34;Get the type of sitemap document.

        Determines the type based on the root element&#39;s local name.

        Returns:
            String indicating the sitemap type:
            - &#39;sitemapindex&#39;: A sitemap index containing references to other sitemaps
            - &#39;urlset&#39;: A sitemap containing page URLs
            - &#39;unsupported&#39;: Any other type of document

        Raises:
            SitemapError: If no document has been loaded
        &#34;&#34;&#34;
        if not hasattr(self, &#34;_root&#34;):  # pragma: no cover
            raise SitemapError(&#34;No root name&#34;)

        localname = etree.QName(self._root.tag).localname
        if localname in [SITEMAPINDEX, URLSET]:
            self._logger.debug(&#34;Identified sitemap type: %s&#34;, localname)
            return localname

        self._logger.warning(&#34;Unsupported sitemap document type: %s&#34;, localname)
        return &#34;unsupported&#34;</code></pre>
</details>
<div class="desc"><p>Parser and representation of XML sitemap documents.</p>
<p>This class handles the parsing, validation, and extraction of entries from
XML sitemap documents, supporting both sitemap index files and urlset files.
It implements security best practices for XML parsing to prevent common
vulnerabilities like XXE attacks.</p>
<p>SitemapDocument distinguishes between sitemap indexes (which contain references
to other sitemaps) and urlsets (which contain actual page URLs), extracting
the appropriate entries in each case.</p>
<h2 id="attributes">Attributes</h2>
<dl>
<dt><strong><code>SITEMAP_NS</code></strong></dt>
<dd>The official sitemap namespace URI</dd>
<dt><strong><code>entries</code></strong></dt>
<dd>ResourceList containing the parsed sitemap entries</dd>
<dt><strong><code>type</code></strong></dt>
<dd>The type of sitemap (sitemapindex, urlset, or unsupported)</dd>
</dl>
<h2 id="example">Example</h2>
<pre><code class="language-python-repl">&gt;&gt;&gt; from ethicrawl.context import Context
&gt;&gt;&gt; from ethicrawl.core import Resource
&gt;&gt;&gt; from ethicrawl.sitemaps import SitemapDocument
&gt;&gt;&gt; context = Context(Resource(&quot;https://example.com&quot;))
&gt;&gt;&gt; sitemap_xml = '''&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
... &lt;urlset xmlns=&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;
...   &lt;url&gt;
...     &lt;loc&gt;&lt;https://example.com/page1&lt;/loc&gt;&gt;
...     &lt;lastmod&gt;2023-06-15T14:30:00Z&lt;/lastmod&gt;
...   &lt;/url&gt;
... &lt;/urlset&gt;'''
&gt;&gt;&gt; sitemap = SitemapDocument(context, sitemap_xml)
&gt;&gt;&gt; sitemap.type
'urlset'
&gt;&gt;&gt; len(sitemap.entries)
1
</code></pre>
<p>Initialize a sitemap document parser with security protections.</p>
<p>Sets up the XML parser with security features to prevent common
XML vulnerabilities and optionally parses a provided document.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>context</code></strong></dt>
<dd>Context for logging and resource resolution</dd>
<dt><strong><code>document</code></strong></dt>
<dd>Optional XML sitemap content to parse immediately</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>SitemapError</code></dt>
<dd>If the provided document cannot be parsed</dd>
</dl></div>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="ethicrawl.sitemaps.index_document.IndexDocument" href="index_document.html#ethicrawl.sitemaps.index_document.IndexDocument">IndexDocument</a></li>
<li><a title="ethicrawl.sitemaps.urlset_document.UrlsetDocument" href="urlset_document.html#ethicrawl.sitemaps.urlset_document.UrlsetDocument">UrlsetDocument</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="ethicrawl.sitemaps.sitemap_document.SitemapDocument.SITEMAP_NS"><code class="name">var <span class="ident">SITEMAP_NS</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="ethicrawl.sitemaps.sitemap_document.SitemapDocument.entries"><code class="name">prop <span class="ident">entries</span> : <a title="ethicrawl.core.resource_list.ResourceList" href="../core/resource_list.html#ethicrawl.core.resource_list.ResourceList">ResourceList</a></code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def entries(self) -&gt; ResourceList:
    &#34;&#34;&#34;Get the list of entries extracted from the sitemap.

    Returns:
        ResourceList containing SitemapEntry objects (either IndexEntry
        or UrlsetEntry depending on the sitemap type)
    &#34;&#34;&#34;
    return self._entries</code></pre>
</details>
<div class="desc"><p>Get the list of entries extracted from the sitemap.</p>
<h2 id="returns">Returns</h2>
<p>ResourceList containing SitemapEntry objects (either IndexEntry
or UrlsetEntry depending on the sitemap type)</p></div>
</dd>
<dt id="ethicrawl.sitemaps.sitemap_document.SitemapDocument.type"><code class="name">prop <span class="ident">type</span> : str</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def type(self) -&gt; str:
    &#34;&#34;&#34;Get the type of sitemap document.

    Determines the type based on the root element&#39;s local name.

    Returns:
        String indicating the sitemap type:
        - &#39;sitemapindex&#39;: A sitemap index containing references to other sitemaps
        - &#39;urlset&#39;: A sitemap containing page URLs
        - &#39;unsupported&#39;: Any other type of document

    Raises:
        SitemapError: If no document has been loaded
    &#34;&#34;&#34;
    if not hasattr(self, &#34;_root&#34;):  # pragma: no cover
        raise SitemapError(&#34;No root name&#34;)

    localname = etree.QName(self._root.tag).localname
    if localname in [SITEMAPINDEX, URLSET]:
        self._logger.debug(&#34;Identified sitemap type: %s&#34;, localname)
        return localname

    self._logger.warning(&#34;Unsupported sitemap document type: %s&#34;, localname)
    return &#34;unsupported&#34;</code></pre>
</details>
<div class="desc"><p>Get the type of sitemap document.</p>
<p>Determines the type based on the root element's local name.</p>
<h2 id="returns">Returns</h2>
<p>String indicating the sitemap type:
- 'sitemapindex': A sitemap index containing references to other sitemaps
- 'urlset': A sitemap containing page URLs
- 'unsupported': Any other type of document</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>SitemapError</code></dt>
<dd>If no document has been loaded</dd>
</dl></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ethicrawl.sitemaps" href="index.html">ethicrawl.sitemaps</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ethicrawl.sitemaps.sitemap_document.SitemapDocument" href="#ethicrawl.sitemaps.sitemap_document.SitemapDocument">SitemapDocument</a></code></h4>
<ul class="">
<li><code><a title="ethicrawl.sitemaps.sitemap_document.SitemapDocument.SITEMAP_NS" href="#ethicrawl.sitemaps.sitemap_document.SitemapDocument.SITEMAP_NS">SITEMAP_NS</a></code></li>
<li><code><a title="ethicrawl.sitemaps.sitemap_document.SitemapDocument.entries" href="#ethicrawl.sitemaps.sitemap_document.SitemapDocument.entries">entries</a></code></li>
<li><code><a title="ethicrawl.sitemaps.sitemap_document.SitemapDocument.type" href="#ethicrawl.sitemaps.sitemap_document.SitemapDocument.type">type</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
